---
title: "A3: SPL Library Checkouts"
output: html_document
---

### Introduction

This dataset informs us on book checkouts in the Seattle Public Library from 2013 up to 2022. It gives information on types of books, types of checkouts, authors, dates, publishers, etc. I chose to analyze the trends of physical book checkouts vs digital books over the years, the type of checkout someone did (magazines, music, movie, etc.) and the authors with the most books checked out. I did this because I am really interested in how the pandemic affected book checkouts and what kind of books people are interested in/checking out. I also chose to find the top authors because I am interested to know if I am familiar with any of them or their works, and I also wanted to see what people are reading the most.

### Summary Information
```{r, echo = FALSE, message = FALSE, code = readLines("summary.R")}
most_ebook_checkouts <- book_checkouts %>% 
  mutate("Date" = paste(sep = "-", CheckoutYear, CheckoutMonth, "01")) %>% 
  group_by(MaterialType, Date) %>% 
  filter(MaterialType == "EBOOK") %>% 
  summarise(most_ebook = max(Checkouts)) %>% 
  slice(which.max(most_ebook)) %>% 
  pull(Date)

least_ebook_checkouts <- book_checkouts %>% 
  mutate("Date" = paste(sep = "-", CheckoutYear, CheckoutMonth, "01")) %>% 
  group_by(MaterialType, Date) %>% 
  filter(MaterialType == "EBOOK") %>% 
  summarise(least_ebook = min(Checkouts)) %>% 
  slice(which.min(least_ebook)) %>% 
  pull(Date)

kate_dicamillo <- book_checkouts %>% 
  filter(Creator == "Kate DiCamillo") %>% 
  mutate("Date" = paste(sep = "-", CheckoutYear, CheckoutMonth, "01")) %>% 
  group_by(Date, Title) %>% 
  summarise(total_checkouts = sum(Checkouts)) %>% 
  arrange(desc(total_checkouts)) %>% 
  top_n(1) %>% 
  pull(Title) 

kate_most<- kate_dicamillo[1]

kate_dicamillo_checkout <- book_checkouts %>% 
  filter(Creator == "Kate DiCamillo") %>% 
  mutate("Date" = paste(sep = "-", CheckoutYear, CheckoutMonth, "01")) %>% 
  group_by(Date, Title) %>% 
  summarise(total_checkouts = sum(Checkouts)) %>% 
  arrange(desc(total_checkouts)) %>% 
  top_n(1) %>% 
  pull(total_checkouts) 

kate_top <- kate_dicamillo_checkout[1]

print_books_2013 <- book_checkouts %>% 
  group_by(UsageClass) %>% 
  filter(CheckoutYear == "2013") %>% 
  filter(UsageClass == "Physical") %>% 
  summarise(phys_2013 = sum(Checkouts)) %>% 
  pull(phys_2013)

dig_books_2013 <- book_checkouts %>% 
  group_by(UsageClass) %>% 
  filter(CheckoutYear == "2013") %>% 
  filter(UsageClass == "Digital") %>% 
  summarise(dig_2013 = sum(Checkouts)) %>% 
  pull(dig_2013)

perc_phys_2013 <- (print_books_2013 / (dig_books_2013 + print_books_2013)) * 100

print_books_2022 <- book_checkouts %>% 
  group_by(UsageClass) %>% 
  filter(CheckoutYear == "2022") %>% 
  filter(UsageClass == "Physical") %>% 
  summarise(phys_2022 = sum(Checkouts)) %>% 
  pull(phys_2022)

dig_books_2022 <- book_checkouts %>% 
  group_by(UsageClass) %>% 
  filter(CheckoutYear == "2022") %>% 
  filter(UsageClass == "Digital") %>% 
  summarise(dig_2022 = sum(Checkouts)) %>% 
  pull(dig_2022)

perc_phys_2022 <- (print_books_2022 / (dig_books_2022 + print_books_2022)) * 100

diff_physical <- print_books_2013 - print_books_2022

```

While analyzing the dataset, I found a few interesting values that reflect the trends I noticed. The first trend I found was confirmed by my first chart. The amount of Physical books being checked out has dramatically decreased between 2013 and 2022. In 2013, physical books made up `r perc_phys_2013` of all the books being checked out. However, in 2022 they only made up `r perc_phys_2022` of all books checked out. Considering the pandemic which didn't allow people to leave their house as much as usual, this number makes sense. Another trend that aligns with this fact is the amount of ebooks checked out in recent years. The date with the highest amount of ebook checkouts is `r most_ebook_checkouts`, unsurprisingly this date is in 2022. `r least_ebook_checkouts` is the date with the least amount of ebook checkouts, which is in 2013. This follows previous trends we have seen, since the popularity of digital books has increased over the past ten years. My favorite author, Kate DiCamillo, has a few books featured in the dataset, however her most popular book is `r kate_most`, with a high of `r kate_top` checkouts in a single month.

### The Dataset

- Who collected/published the data?  
- What are the parameters of the data (dates, number of checkouts, kinds of books, etc.)?
- How was the data collected or generated?  
- Why was the data collected?  
- What, if any, ethical questions do you need to consider when working with this data?  
- What are possible limitations or problems with this data?   (at least 200 words)


### First Trends Over Time Chart

Include a chart. Make sure to describe why you included the chart, and what patterns emerged

The first chart that you will create and include will show the trend over time of your variable/topic/interest. Think carefully about what you want to communicate to your user (you may have to find relevant trends in the dataset first!). Here are some requirements to help guide your design:

- Show more than one, but fewer than ~10 trends
  - For example, two books, or 5 different mediums
- You must have clear x and y axis labels
- The chart needs a clear title 
- You need a legend for your different line colors and a clear - legend title
In your .Rmd file, make sure to describe why you included the chart, and what patterns emerged

When we say "clear" or "human readable" titles and labels, that means that you should not just display the variable name.

Here's an example of how to run an R script inside an RMarkdown file:

```{r, echo = FALSE, message = FALSE, code = readLines("Chart1.R")}

physical_values <- book_checkouts %>% 
  group_by(CheckoutYear) %>% 
  filter(UsageClass == "Physical") %>% 
  summarise(avg_physical = mean(Checkouts))
digital_values <- book_checkouts %>% 
  group_by(CheckoutYear) %>% 
  filter(UsageClass == "Digital") %>% 
  summarise(avg_digital = mean(Checkouts)) 
book_type <- left_join(physical_values, digital_values, join_by("CheckoutYear"))


ggplot(book_type) +
  geom_line(mapping = aes(x = CheckoutYear, y = avg_physical, color = "Physical")) +
  geom_line(mapping = aes(x = CheckoutYear, y = avg_digital, color = "Digital")) +
  labs(title = "Physical VS Digital Book Checkout Over A Decade", x = "Year", y = "# of Books Checked Out Per Person", color = "Type of Book") + 
  scale_x_continuous(breaks = seq(2013, 2023, 2))
  
  
```

### Second Trends Over Time Chart

I included this chart to show the trends of the type of checkouts over time. By type of checkout, I mean if people checked out books, movies, music, 

```{r, echo = FALSE, message = FALSE, code = readLines("Chart2.R")}
freegal_checkouts <- book_checkouts %>% 
  group_by(CheckoutYear, CheckoutType) %>% 
  summarise(avg_freegal = mean(Checkouts)) %>% 
  filter(CheckoutType == "Freegal") %>% 
  select(CheckoutYear, avg_freegal)

hoopla_checkouts <- book_checkouts %>% 
  group_by(CheckoutYear, CheckoutType) %>% 
  summarise(avg_hoopla = mean(Checkouts)) %>% 
  filter(CheckoutType == "Hoopla") %>% 
  select(CheckoutYear, avg_hoopla)

horizon_checkouts <- book_checkouts %>% 
  group_by(CheckoutYear, CheckoutType) %>% 
  summarise(avg_horizon = mean(Checkouts)) %>% 
  filter(CheckoutType == "Horizon") %>% 
  select(CheckoutYear, avg_horizon)

overdrive_checkouts <- book_checkouts %>% 
  group_by(CheckoutYear, CheckoutType) %>% 
  summarise(avg_overdrive = mean(Checkouts)) %>% 
  filter(CheckoutType == "OverDrive") %>% 
  select(CheckoutYear, avg_overdrive)

zinio_checkouts <- book_checkouts %>% 
  group_by(CheckoutYear,CheckoutType) %>% 
  summarise(avg_zinio = mean(Checkouts)) %>% 
  filter(CheckoutType == "Zinio") %>% 
  select(CheckoutYear, avg_zinio)

all_checkouts <- freegal_checkouts %>% 
  left_join(hoopla_checkouts, by = "CheckoutYear") %>% 
  left_join(horizon_checkouts, by = "CheckoutYear") %>% 
  left_join(overdrive_checkouts, by = "CheckoutYear") %>% 
  left_join(zinio_checkouts, by = "CheckoutYear")

ggplot(all_checkouts) +
  geom_line(aes(x = CheckoutYear, y = avg_freegal, color = "Freegal")) +
  geom_line(aes(x = CheckoutYear, y = avg_hoopla, color = "Hoopla")) +
  geom_line(aes(x = CheckoutYear, y = avg_horizon, color = "Horizon")) +
  geom_line(aes(x = CheckoutYear, y = avg_overdrive, color = "Overdrive")) +
  geom_line(aes(x = CheckoutYear, y = avg_zinio, color = "Zinio")) +
  labs(title = "Types of Checkout Over A Decade", x = "Year", y = "Average # of Books Checked Out Per System", color = "Type of System") + 
  scale_x_continuous(breaks = seq(2013, 2023, 2))


```

### Your Choice

The last chart is up to you. It could be a line plot, scatter plot, histogram, bar plot, stacked bar plot, and more. Here are some requirements to help guide your design:

- You must have clear x and y axis labels
- The chart needs a clear title 
- You need a legend for your different line colors and a clear legend title

Here's an example of how to run an R script inside an RMarkdown file:

```{r, echo = FALSE, message = FALSE, code = readLines("Chart3.R")}

most_common <- book_checkouts %>% 
  group_by(Publisher, Creator) %>% 
  filter(Creator != "") %>% 
  summarise(Checkouts = sum(Checkouts)) %>% 
  arrange(desc(Checkouts))

top_5 <- head(most_common, 5)

ggplot(top_5, aes(x = Creator, y = Checkouts, color = Creator, fill = Creator)) +
  geom_bar(stat = "identity")

```